
<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
        <title>Labelimg批量标注脚本 | Liteee的世界尽头</title>
        <meta name="author" content="Liteee">
        <meta name="description" content="这仅仅是暮色中的幻想，一睁眼水泡即杳然逝去，有的只是兽的蹄音，小镇仍一如往常。">
        <meta name="keywords" content="游戏">
        <link rel="icon" href="Avator.png">
        <script src="https://cdn.staticfile.org/instant.page/5.1.0/instantpage.min.js" type="module"></script>
        <script src="https://cdn.staticfile.org/font-awesome/6.2.0/js/all.min.js"></script>
        
        <link rel="stylesheet" href="/css/fonts.min.css">
        <link rel="stylesheet" href="/css/particlex.css">
        
        <script src="https://cdn.staticfile.org/vue/3.2.33/vue.global.prod.min.js"></script>
    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <div id="loading" style="height:100vh;width:100vw;position:fixed;display:flex;z-index:200;justify-content:space-between;background:#fff;transition:opacity 0.3s ease-out"><div style="position:fixed;height:100vh;width:100vw;display:flex;justify-content:center;align-items:center"><div id="loadcontent" style="width:50vmin;height:50vmin;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px #a3ddfb;text-align:center"><div><h2>LOADING...</h2><p style="word-break:keep-all">加载过慢请开启缓存(浏览器默认开启)</p><div><img alt="loading" src="/loading.gif"></div></div></div></div></div>
        <div id="layout">
            <i data-fa-symbol="calendar-solid" class="fa-solid fa-calendar fa-fw"></i>
            <i data-fa-symbol="bookmark-solid" class="fa-solid fa-bookmark fa-fw"></i>
            <i data-fa-symbol="tags-solid" class="fa-solid fa-tags fa-fw"></i>
            <transition name="into">
                <div v-show="show_page" style="display: -not-none">
                    <div id="menu_show">
                         
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">Liteee的世界尽头</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;about</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;tags</span>
        </a>
        
    </div>
    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div class="curtain" @click="menu_show = !menu_show" v-show="menu_show"></div>
        <div :class="'title'" @click="menu_show = !menu_show">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;Liteee的世界尽头</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">home</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">about</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">archives</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">categories</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>
                    </div>
                    <div id="main">
                        
<div class="article">
    <div>
        <h1>Labelimg批量标注脚本 </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2023/2/27
        </span>
        
        <span class="category">
            <a href="/categories/机器学习/">
                <span class="icon">
                    <svg class="fa-icon"><use xlink:href="#bookmark-solid"></use></svg>
                </span>
                机器学习
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
            </span>
            
            <span class="tag">
                
                <a href="/tags/数据标注/" style="color: #ff7d73">
                    数据标注
                </a>
            </span>
            
        </span>
        
    </div>
    <div class="content" v-pre>
        <p>网上没找到解决方案，现写一个labelimg批量标注工具<br> <span id="more"></span></p>
<h1 id="使用背景"><a href="#使用背景" class="headerlink" title="使用背景"></a>使用背景</h1><p>在使用labelimg进行目标检测标注时，如果某些物体在相同地方重复出现多次，labelimg并没有提供适合的方式去批量标注。</p>
<p>对于这种物体，人工标注的方式一是比较麻烦，二是手动标注每次都有偏差，不如精确地标一次然后进行批处理。</p>
<p>没找到有人做这个插件，因此写个脚本，解决labelimg不能跨图片批量复制选框的问题。</p>
<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><p>在视频任务中，待测物体在很多帧里的位置没有变化时。labelimg没有提供跨图片复制标注框的功能。</p>
<p>通过批量修改标签xml文件的方式，来实现相应复制选框操作。因此写了个小工具</p>
<p>可以大量减少标注工作量，也可以减少重复标注的不稳定性</p>
<p>调用代码如下：</p>
<pre><code class="python">
 # 设置文件夹路径
 floader_path=&quot;G:/labels&quot;
 # 参数：（label目录，文件标识，标签名，标签的四个信息）
 # 文件标识：函数会修改所有名字中带有此标识的文件
 add_label(floader_path,&quot;1022_186_&quot;,&quot;paper&quot;,&quot;1339&quot;,&quot;1297&quot;,&quot;1483&quot;,&quot;1422&quot;)
 #删除最近一批的标签，作为ADD的反向操作（撤销），解决标注失误的情况
 #参数（label目录，文件标识）
 delete_last_label(floader_path,&quot;1022_186&quot;)
</code></pre>
<h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h4><p>在本次任务中，每一批镜头的唯一编号通常为</p>
<p><img src="https://00-1305867505.cos.ap-guangzhou.myqcloud.com/20230227141631.png" alt="20230227141631"></p>
<h5 id="步骤1-在labelimg中打标签"><a href="#步骤1-在labelimg中打标签" class="headerlink" title="步骤1 在labelimg中打标签"></a>步骤1 在labelimg中打标签</h5><p>记下文件名，搜索同名的xml文件，找到框的参数<br><img src="https://00-1305867505.cos.ap-guangzhou.myqcloud.com/20230227142724.png" alt="20230227142724"><br>目标框参数：</p>
<p><img src="https://00-1305867505.cos.ap-guangzhou.myqcloud.com/20230227142434.png" alt="20230227142434"></p>
<h5 id="步骤2-得到参数，然后填入函数中"><a href="#步骤2-得到参数，然后填入函数中" class="headerlink" title="步骤2 得到参数，然后填入函数中"></a>步骤2 得到参数，然后填入函数中</h5><pre><code class="python">
  change_xml(floader_path,&quot;1022_100_&quot;,&quot;paper&quot;,&quot;1639&quot;,&quot;335&quot;,&quot;1706&quot;,&quot;375&quot;)
</code></pre>
<h4 id="处理结果："><a href="#处理结果：" class="headerlink" title="处理结果："></a>处理结果：</h4><p><img src="https://00-1305867505.cos.ap-guangzhou.myqcloud.com/20230227142739.png" alt="20230227142739"></p>
<h1 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h1><p>不仅限于批量标注，也可以进行其他批处理操作。</p>
<pre><code class="python">from xml.etree.ElementTree import ElementTree,Element
from pathlib import Path
# 读取并解析xml文件
def read_xml(in_path):
&#39;&#39;&#39;读取并解析xml文件
  in_path: xml路径
  return: ElementTree&#39;&#39;&#39;
tree = ElementTree()
tree.parse(in_path)
return tree

def write_xml(tree, out_path):
&#39;&#39;&#39;将xml文件写出
  tree: xml树
  out_path: 写出路径&#39;&#39;&#39;
tree.write(out_path, encoding=&quot;utf-8&quot;,xml_declaration=True)

def if_match(node, kv_map):
&#39;&#39;&#39;判断某个节点是否包含所有传入参数属性
  node: 节点
  kv_map: 属性及属性值组成的map&#39;&#39;&#39;
for key in kv_map:
  if node.get(key) != kv_map.get(key):
    return False
return True

#---------------search -----
def find_nodes(tree, path):
&#39;&#39;&#39;查找某个路径匹配的所有节点
  tree: xml树
  path: 节点路径&#39;&#39;&#39;
return tree.findall(path)

def get_node_by_keyvalue(nodelist, kv_map):
&#39;&#39;&#39;根据属性及属性值定位符合的节点，返回节点
  nodelist: 节点列表
  kv_map: 匹配属性及属性值map&#39;&#39;&#39;
result_nodes = []
for node in nodelist:
  if if_match(node, kv_map):
    result_nodes.append(node)
return result_nodes

#---------------change -----
def change_node_properties(nodelist, kv_map, is_delete=False):
&#39;&#39;&#39;修改/增加 /删除 节点的属性及属性值
  nodelist: 节点列表
  kv_map:属性及属性值map&#39;&#39;&#39;
for node in nodelist:
  for key in kv_map:
    if is_delete:
      if key in node.attrib:
        del node.attrib[key]
    else:
      node.set(key, kv_map.get(key))

def change_node_text(nodelist, text, is_add=False, is_delete=False):
&#39;&#39;&#39;改变/增加/删除一个节点的文本
  nodelist:节点列表
  text : 更新后的文本&#39;&#39;&#39;
for node in nodelist:
  if is_add:
    node.text += text
  elif is_delete:
    node.text = &quot;&quot;
  else:
    node.text = text

def create_node(tag, property_map, content):
&#39;&#39;&#39;新造一个节点
  tag:节点标签
  property_map:属性及属性值map
  content: 节点闭合标签里的文本内容
  return 新节点&#39;&#39;&#39;
element = Element(tag, property_map)
element.text = content
return element

def add_child_node(nodelist, element):
&#39;&#39;&#39;给一个节点添加子节点
  nodelist: 节点列表
  element: 子节点&#39;&#39;&#39;
for node in nodelist:
  node.append(element)

def del_node_by_tagkeyvalue(nodelist, tag, kv_map):
&#39;&#39;&#39;同过属性及属性值定位一个节点，并删除之
  nodelist: 父节点列表
  tag:子节点标签
  kv_map: 属性及属性值列表&#39;&#39;&#39;
for parent_node in nodelist:
  children = parent_node.getchildren()
  for child in children:
    if child.tag == tag and if_match(child, kv_map):
      parent_node.remove(child)

def my_add_child_node(node, element):
&#39;&#39;&#39;给一个节点添加子节点
  nodelist: 节点列表
  element: 子节点&#39;&#39;&#39;
node.append(element)

def construct_object(name,xmin,ymin,xmax,ymax):
# object = create_node(&quot;object&quot;, &#123;&quot;age&quot;: &quot;15&quot;, &quot;money&quot;: &quot;200000&quot;&#125;, &quot;this is the firest content&quot;)
object_node = create_node(&quot;object&quot;,&#123;&#125;,&quot;&quot;)

#object 子节点
name_node=create_node(&quot;name&quot;,&#123;&#125;,name)
pose_node=create_node(&quot;Unspecified&quot;,&#123;&#125;,&quot;&quot;)
truncated_node=create_node(&quot;truncated&quot;,&#123;&#125;,&quot;0&quot;)
diffcult_node=create_node(&quot;diffcult&quot;,&#123;&#125;,&quot;0&quot;)
bndbox_node=create_node(&quot;bndbox&quot;,&#123;&#125;,&quot;0&quot;)

# bndbox 子节点
xmin_node=create_node(&quot;xmin&quot;,&#123;&#125;,xmin)
xmax_node=create_node(&quot;xmax&quot;,&#123;&#125;,xmax)
ymin_node=create_node(&quot;ymin&quot;,&#123;&#125;,ymin)
ymax_node=create_node(&quot;ymax&quot;,&#123;&#125;,ymax)
bndbox_node.append(xmin_node)
bndbox_node.append(xmax_node)
bndbox_node.append(ymin_node)
bndbox_node.append(ymax_node)
object_node.append(name_node)
object_node.append(pose_node)
object_node.append(truncated_node)
object_node.append(diffcult_node)
object_node.append(bndbox_node)
return object_node

def add_label(path,code,label_name,xmin,ymin,xmax,ymax):
&#39;&#39;&#39;path文件夹目录
code文件编号
label_name标签名
其他为框的参数
&#39;&#39;&#39;
list = []
label_floader = [file for file in Path(path).iterdir()]  # 遍历目录下的文件
for file_path in label_floader:
  if(str(file_path).find(code)!=-1):
    print(file_path)
    # 批量添加某个标签框
    tree = read_xml(file_path)
    #获取根节点
    root=tree.getroot()
    #构造新的框节点
    new_node=construct_object(label_name,xmin,ymin,xmax,ymax)
    #添加节点
    my_add_child_node(root, new_node)
    #输出xml
    # output_path=&quot;.output&quot;
    write_xml(tree, file_path)

def delete_last_label(path,code):
   list = []
   label_floader = [file for file in Path(path).iterdir()]  # 遍历目录下的文件
   for file_path in label_floader:
       if (str(file_path).find(code) != -1):
           #显示文件目录
           print(file_path)
           #构造ET树
           tree = read_xml(file_path)
           #获取根节点
           root = tree.getroot()
           #获取最后节点
           for node in root:
               lastnode=node
           #删除节点
           root.remove(lastnode)
           tree = ElementTree(root)
           write_xml(tree, file_path)

if __name__ == &quot;__main__&quot;:
# 遍历文件夹
floader_path=&quot;G:/labels&quot;
# 参数：（label目录，文件编号，标签名，标签的四个信息）
add_label(floader_path,&quot;1022_186_&quot;,&quot;paper&quot;,&quot;1339&quot;,&quot;1297&quot;,&quot;1483&quot;,&quot;1422&quot;)
#删除最近一次的标签，作为ADD的反向操作
delete_last_label(floader_path,&quot;1022_186&quot;)

 # 网上抄的其他示例
 #1. 读取xml文件
 # path=&quot;C:/Users/10679/Desktop/新建文件夹/label/1022_82_30000.xml&quot;
 # tree = read_xml(path)
 # root=tree.getroot()
 # print(root.tag)
 # for tag in root:
 #   print(tag)
 #2. 属性修改
  #A. 找到父节点
 # nodes = find_nodes(tree, &quot;annotation&quot;)
 # print(nodes)
 #  #B. 通过属性准确定位子节点
 # result_nodes = get_node_by_keyvalue(root, &#123;&quot;name&quot;:&quot;object&quot;&#125;)
 # print(result_nodes)
 #  #C. 修改节点属性
 # change_node_properties(result_nodes, &#123;&quot;age&quot;: &quot;1&quot;&#125;)
 #  #D. 删除节点属性
 # change_node_properties(result_nodes, &#123;&quot;value&quot;:&quot;&quot;&#125;, True)
 #
 #3. 节点修改
  #A.新建节点
 # a = create_node(&quot;object&quot;, &#123;&quot;age&quot;:&quot;15&quot;,&quot;money&quot;:&quot;200000&quot;&#125;, &quot;this is the firest content&quot;)
  #B.插入到父节点之下

 # new_node=construct_object(&quot;sexy&quot;,&quot;1609&quot;,&quot;1329&quot;,&quot;1710&quot;,&quot;375&quot;)
 # my_add_child_node(root, new_node)
 #
 # #4. 删除节点
 #   #定位父节点
 # del_parent_nodes = find_nodes(tree, &quot;processers/services/service&quot;)
 #   #准确定位子节点并删除之
 # target_del_node = del_node_by_tagkeyvalue(del_parent_nodes, &quot;chain&quot;, &#123;&quot;sequency&quot; : &quot;chain1&quot;&#125;)
 #
 # #5. 修改节点文本
 #   #定位节点
 # text_nodes = get_node_by_keyvalue(find_nodes(tree, &quot;processers/services/service/chain&quot;), &#123;&quot;sequency&quot;:&quot;chain3&quot;&#125;)
 # change_node_text(text_nodes, &quot;new text&quot;)
 #
 # #6. 输出到结果文件
 # write_xml(tree, &quot;./out.xml&quot;)

</code></pre>

    </div>
    
    
</div>
                         
<footer id="footer">
    <div class="footer-wrap">
        <div>
            © 20xx - 2023 Liteee的世界尽头
            <span class="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            @Liteee
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a> & <a
                target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a></div>
        
    </div>
</footer>
                    </div>
                </div>
            </transition>
            <div id="img_show">
                <img id="img_content" alt="img_show">
            </div>
        </div>
        <script src="https://cdn.staticfile.org/highlight.js/11.5.1/highlight.min.js"></script>
        <script src="/js/particlex.js"></script>
        <script src="/js/showimg.js"></script>
        

    </body>
</html>